<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tyler's Paint Shop — Demo Store</title>
<style>
  :root{
    --accent:#2b6cb0; --muted:#6b7280; --card:#ffffff; --bg:#f7fafc;
    --glass: rgba(255,255,255,0.7);
    font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body{ margin:0; background:var(--bg); color:#111; }
  header{ display:flex; align-items:center; justify-content:space-between; gap:1rem;
           padding:1rem 1.25rem; background:linear-gradient(90deg,var(--glass),transparent);
           position:sticky; top:0; backdrop-filter: blur(6px); z-index:10; }
  .brand{ display:flex; gap:.75rem; align-items:center; }
  .logo{ width:44px; height:44px; border-radius:8px; background:linear-gradient(135deg,#06b6d4,#3b82f6); display:flex; align-items:center; justify-content:center; color:white; font-weight:700; }
  h1{ margin:0; font-size:1.05rem; letter-spacing:.2px; }
  .controls{ display:flex; gap:.5rem; align-items:center; }
  button{ background:var(--accent); color:white; border:0; padding:.45rem .7rem; border-radius:8px; cursor:pointer; font-weight:600; }
  button.ghost{ background:transparent; color:var(--accent); border:1px solid rgba(43,108,176,0.15); }
  main{ padding:1.25rem; max-width:1100px; margin:12px auto; }
  .layout{ display:grid; grid-template-columns: 1fr 320px; gap:1rem; }
  @media (max-width:980px){ .layout{ grid-template-columns: 1fr; } .sidebar{ order:2; } }
  .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:1rem; }
  .card{ background:var(--card); border-radius:12px; padding:12px; box-shadow:0 6px 18px rgba(15,23,42,0.06); }
  .product-img{ width:100%; height:160px; object-fit:cover; border-radius:8px; background:#e6eef7; display:block; }
  .meta{ padding-top:.5rem; display:flex; justify-content:space-between; align-items:center; gap:.5rem; }
  .title{ font-weight:700; font-size:.98rem; }
  .price{ color:var(--accent); font-weight:700; }
  .small{ font-size:.87rem; color:var(--muted); }
  .sidebar .card{ position:sticky; top:80px; }
  .cart-list{ max-height:360px; overflow:auto; display:flex; flex-direction:column; gap:.75rem; margin-top:.5rem; }
  .cart-item{ display:flex; gap:.6rem; align-items:center; }
  .cart-item img{ width:60px; height:60px; object-fit:cover; border-radius:6px; }
  .qty{ display:flex; gap:.25rem; align-items:center; }
  input[type=number], input[type=text], input[type=email], textarea, select{
    width:100%; padding:.5rem .6rem; border-radius:8px; border:1px solid #e6eef7; outline:none;
  }
  label{ font-weight:600; font-size:.85rem; display:block; margin-bottom:.35rem; color:#111827; }
  form .row{ display:grid; grid-template-columns:1fr 1fr; gap:.6rem; }
  @media (max-width:540px){ form .row{ grid-template-columns:1fr; } }
  .empty{ text-align:center; color:var(--muted); padding:2rem 1rem; border-radius:8px; }
  .seller-banner{ background:linear-gradient(90deg,#ecfccb,#bbf7d0); padding:.6rem; border-radius:8px; display:flex; gap:.6rem; align-items:center; }
  .actions{ display:flex; gap:.5rem; align-items:center; justify-content:flex-end; }
  .tag{ background:#eef2ff; color:#4338ca; padding:.18rem .45rem; border-radius:999px; font-size:.75rem; }
  footer{ text-align:center; color:var(--muted); padding:1rem; font-size:.9rem; margin-top:1rem; }
  .modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(10,10,10,0.35); z-index:30; }
  .modal .card{ max-width:720px; width:96%; }
  .flex{ display:flex; gap: .6rem; align-items:center; }
  .download{ background:#111827; }
  a.smalllink{ font-size:.85rem; color:var(--muted); text-decoration:underline; cursor:pointer; }
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">TP</div>
    <div>
      <h1>Tyler's Paint Shop</h1>
      <div class="small">Hand-painted goods • Demo store</div>
    </div>
  </div>

  <div class="controls">
    <div class="small">Mode:</div>
    <select id="modeToggle" aria-label="Mode">
      <option value="shop">Shop</option>
      <option value="seller">Seller</option>
    </select>
    <button id="cartBtn" class="ghost">Cart (<span id="cartCount">0</span>)</button>
  </div>
</header>

<main>
  <div class="layout">
    <section class="catalog">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem;">
        <h2 style="margin:0">Products</h2>
        <div class="actions">
          <input id="search" placeholder="Search products..." style="padding:.45rem .6rem;border-radius:8px;border:1px solid #e6eef7"/>
          <button id="addProductBtn">+ Add product</button>
        </div>
      </div>

      <div id="productGrid" class="grid"></div>

      <div id="emptyProducts" class="card empty" style="display:none;">
        No products yet. Switch to <b>Seller</b> mode and click "Add product" to create items.
      </div>
    </section>

    <aside class="sidebar">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div><strong>Cart</strong><div class="small">Quick view</div></div>
          <div class="small">Total: <span id="cartTotal">$0.00</span></div>
        </div>

        <div id="cartList" class="cart-list"></div>

        <div style="margin-top:.8rem; display:flex; gap:.5rem;">
          <button id="checkoutBtn">Checkout</button>
          <button id="clearCart" class="ghost">Clear</button>
          <button id="downloadOrders" class="ghost">Download Orders</button>
        </div>

        <div style="margin-top:.9rem;" class="small">Tip: Switch to <b>Seller</b> mode to add new painted items.</div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <div class="seller-banner">
          <div style="font-weight:700">Seller tools</div>
          <div class="small">Inventory & orders</div>
        </div>
        <div style="margin-top:.6rem">
          <div class="small">Local demo store — data saved in browser storage.</div>
          <div style="margin-top:.5rem">
            <button id="openInventory" class="ghost">Open Inventory</button>
          </div>
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- Modals -->
<div id="productModal" style="display:none" class="modal" aria-hidden="true">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3 id="pmTitle">Product</h3>
      <div><button id="closePm" class="ghost">Close</button></div>
    </div>
    <div style="display:flex;gap:1rem;margin-top:.6rem;">
      <img id="pmImg" src="" alt="" style="width:220px;height:220px;object-fit:cover;border-radius:8px">
      <div style="flex:1">
        <div id="pmDesc" class="small"></div>
        <div style="margin-top:.6rem"><span class="price" id="pmPrice"></span></div>
        <div style="margin-top:.6rem" class="small">In stock: <span id="pmQty"></span></div>
        <div style="margin-top:1rem; display:flex; gap:.6rem;">
          <input id="pmQtyInput" type="number" min="1" value="1" style="width:88px">
          <button id="pmAddCart">Add to cart</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="sellerModal" style="display:none" class="modal" aria-hidden="true">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3>Add / Edit Product</h3>
      <div><button id="closeSeller" class="ghost">Close</button></div>
    </div>

    <form id="productForm" style="margin-top:.8rem;">
      <input type="hidden" id="prodId">
      <div class="row">
        <div>
          <label>Title</label>
          <input id="prodTitle" required />
        </div>
        <div>
          <label>Price (USD)</label>
          <input id="prodPrice" type="number" min="0" step="0.01" required />
        </div>
      </div>

      <div style="margin-top:.6rem">
        <label>Description</label>
        <textarea id="prodDesc" rows="3"></textarea>
      </div>

      <div class="row" style="margin-top:.6rem">
        <div>
          <label>Quantity</label>
          <input id="prodQty" type="number" min="0" value="1"/>
        </div>
        <div>
          <label>Tags (comma separated)</label>
          <input id="prodTags" placeholder="e.g., home,wall art,gift" />
        </div>
      </div>

      <div style="margin-top:.6rem">
        <label>Image</label>
        <input id="prodImage" type="file" accept="image/*" />
        <div style="margin-top:.5rem">
          <img id="previewImg" src="" alt="" style="width:120px;height:120px;object-fit:cover;border-radius:8px;display:none;">
        </div>
      </div>

      <div style="display:flex;gap:.5rem;margin-top:.8rem;justify-content:flex-end;">
        <button type="submit">Save product</button>
        <button id="deleteProduct" class="ghost" type="button">Delete</button>
      </div>
    </form>
  </div>
</div>

<div id="checkoutModal" style="display:none" class="modal" aria-hidden="true">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3>Checkout</h3>
      <div><button id="closeCheckout" class="ghost">Close</button></div>
    </div>

    <form id="checkoutForm" style="margin-top:.8rem;">
      <label>Full name</label>
      <input id="custName" required />
      <label style="margin-top:.5rem">Email</label>
      <input id="custEmail" type="email" required />
      <label style="margin-top:.5rem">Shipping address</label>
      <textarea id="custAddr" rows="3" required></textarea>

      <div style="display:flex;gap:.6rem;margin-top:.8rem;align-items:center;">
        <div class="small">Total: <strong id="checkoutTotal">$0.00</strong></div>
        <div style="flex:1"></div>
        <button type="submit">Place order</button>
      </div>
    </form>
  </div>
</div>

<footer>Demo store — data stored in your browser. When ready: deploy to GitHub Pages or add Stripe for real payments.</footer>

<script>
/* Simple demo store using localStorage
   Data shapes:
   - products: [{id,title,desc,price,qty,tags:[],imageDataURL}]
   - cart: {productId: qty}
   - orders: [{id,timestamp,customer,total,items:[{id,title,price,qty}],note}]
*/

const LS_PRODUCTS = 'demo_products_v1';
const LS_CART = 'demo_cart_v1';
const LS_ORDERS = 'demo_orders_v1';

function uid(prefix='id') { return prefix + '_' + Math.random().toString(36).slice(2,10); }

/* Utilities */
function money(n){ return '$' + Number(n).toFixed(2); }
function loadJSON(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) || fallback; }catch(e){ return fallback; } }
function saveJSON(key,val){ localStorage.setItem(key, JSON.stringify(val)); }

/* State */
let products = loadJSON(LS_PRODUCTS, []);
let cart = loadJSON(LS_CART, {});
let orders = loadJSON(LS_ORDERS, []);

/* Elements */
const productGrid = document.getElementById('productGrid');
const emptyProducts = document.getElementById('emptyProducts');
const cartList = document.getElementById('cartList');
const cartTotalEl = document.getElementById('cartTotal');
const cartCountEl = document.getElementById('cartCount');
const modeToggle = document.getElementById('modeToggle');
const addProductBtn = document.getElementById('addProductBtn');
const sellerModal = document.getElementById('sellerModal');
const productModal = document.getElementById('productModal');
const checkoutModal = document.getElementById('checkoutModal');
const productForm = document.getElementById('productForm');
const prodImage = document.getElementById('prodImage');
const previewImg = document.getElementById('previewImg');
const downloadOrdersBtn = document.getElementById('downloadOrders');

const searchInput = document.getElementById('search');
const openInventory = document.getElementById('openInventory');

/* Init sample product if empty (so you see something) */
if(products.length === 0){
  products.push({
    id: uid('p'),
    title: 'Small painted canvas - Sunrise',
    desc: '6x6 in. original acrylic painting. Signed on back.',
    price: 25.00,
    qty: 3,
    tags:['canvas','small','sunrise'],
    imageDataURL: ''
  });
  saveProducts();
}

/* Render */
function renderProducts(filter=''){
  productGrid.innerHTML = '';
  let visible = products.filter(p => p.title.toLowerCase().includes(filter.toLowerCase()) || (p.tags||[]).join(' ').toLowerCase().includes(filter.toLowerCase()));
  if(visible.length === 0){ emptyProducts.style.display='block'; } else { emptyProducts.style.display='none'; }
  visible.forEach(p=>{
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <img class="product-img" src="${p.imageDataURL || placeholderData(p.title)}" alt="${p.title}">
      <div class="meta">
        <div>
          <div class="title">${escapeHtml(p.title)}</div>
          <div class="small">${escapeHtml(p.desc || '')}</div>
        </div>
        <div style="text-align:right;">
          <div class="price">${money(p.price)}</div>
          <div class="small">Stock: ${p.qty}</div>
        </div>
      </div>
      <div style="margin-top:.6rem; display:flex; gap:.5rem; justify-content:space-between;">
        <div style="display:flex; gap:.4rem;">
          ${(p.tags||[]).slice(0,3).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join(' ')}
        </div>
        <div style="display:flex; gap:.4rem;">
          <button class="ghost viewBtn" data-id="${p.id}">View</button>
          <button class="addBtn" data-id="${p.id}">Add</button>
        </div>
      </div>
    `;
    productGrid.appendChild(div);
  });
  wireProductButtons();
}

function wireProductButtons(){
  productGrid.querySelectorAll('.viewBtn').forEach(b=>b.onclick = (e)=>openProductModal(e.target.dataset.id));
  productGrid.querySelectorAll('.addBtn').forEach(b=>b.onclick = (e)=>addToCart(e.target.dataset.id,1));
}

function renderCart(){
  cartList.innerHTML = '';
  const ids = Object.keys(cart);
  if(ids.length===0){ cartList.innerHTML = '<div class="empty">Your cart is empty.</div>'; cartTotalEl.textContent='$0.00'; cartCountEl.textContent='0'; return; }
  let total = 0, count = 0;
  ids.forEach(id=>{
    const p = products.find(x=>x.id===id);
    if(!p) return;
    const qty = cart[id];
    total += p.price * qty;
    count += qty;
    const div = document.createElement('div'); div.className='cart-item';
    div.innerHTML = `
      <img src="${p.imageDataURL || placeholderData(p.title)}" alt="">
      <div style="flex:1">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>${escapeHtml(p.title)}</strong><div class="small">${money(p.price)}</div></div>
          <div>
            <div class="qty">
              <input data-id="${id}" class="cartQty" type="number" min="1" value="${qty}" style="width:64px;padding:.3rem;border-radius:6px;border:1px solid #e6eef7;">
              <button class="removeItem ghost" data-id="${id}" style="margin-left:.4rem;">Remove</button>
            </div>
          </div>
        </div>
      </div>
    `;
    cartList.appendChild(div);
  });
  cartTotalEl.textContent = money(total);
  cartCountEl.textContent = count;
  // wire qty and remove
  cartList.querySelectorAll('.cartQty').forEach(i=>i.onchange = (e)=>{ const id=e.target.dataset.id; const val=parseInt(e.target.value)||1; cart[id]=val; saveCart(); renderCart(); });
  cartList.querySelectorAll('.removeItem').forEach(b=>b.onclick = (e)=>{ delete cart[e.target.dataset.id]; saveCart(); renderCart(); });
}

/* Product modal */
function openProductModal(id){
  const p = products.find(x=>x.id===id); if(!p) return;
  document.getElementById('pmTitle').textContent = p.title;
  document.getElementById('pmImg').src = p.imageDataURL || placeholderData(p.title);
  document.getElementById('pmDesc').textContent = p.desc || '';
  document.getElementById('pmPrice').textContent = money(p.price);
  document.getElementById('pmQty').textContent = p.qty;
  document.getElementById('pmQtyInput').value = 1;
  productModal.style.display = 'flex'; productModal.setAttribute('aria-hidden','false');
  document.getElementById('pmAddCart').onclick = ()=>{ addToCart(p.id, Number(document.getElementById('pmQtyInput').value||1)); closeProductModal(); };
}
function closeProductModal(){ productModal.style.display='none'; productModal.setAttribute('aria-hidden','true'); }

/* Cart operations */
function addToCart(productId, qty=1){
  const p = products.find(x=>x.id===productId); if(!p) return alert('Product not found');
  cart[productId] = (cart[productId]||0) + qty;
  if(cart[productId] > p.qty) cart[productId] = p.qty;
  saveCart(); renderCart();
}

/* Save/load */
function saveProducts(){ saveJSON(LS_PRODUCTS, products); }
function saveCart(){ saveJSON(LS_CART, cart); }
function saveOrders(){ saveJSON(LS_ORDERS, orders); }

/* Seller modal (add/edit product) */
addProductBtn.onclick = ()=>{ if(modeToggle.value !== 'seller'){ modeToggle.value='seller'; alert('Switched to Seller mode'); } openSellerModal(); };
openInventory.onclick = ()=>{ if(modeToggle.value !== 'seller'){ modeToggle.value='seller'; alert('Switched to Seller mode'); } openSellerModal(); };

function openSellerModal(editId){
  document.getElementById('prodId').value = editId || '';
  document.getElementById('prodTitle').value = '';
  document.getElementById('prodPrice').value = 0;
  document.getElementById('prodDesc').value = '';
  document.getElementById('prodQty').value = 1;
  document.getElementById('prodTags').value = '';
  previewImg.style.display='none'; previewImg.src='';
  document.getElementById('deleteProduct').style.display = editId ? 'inline-block' : 'none';
  if(editId){
    const p = products.find(x=>x.id===editId);
    if(p){ document.getElementById('prodTitle').value=p.title; document.getElementById('prodPrice').value=p.price; document.getElementById('prodDesc').value=p.desc; document.getElementById('prodQty').value=p.qty; document.getElementById('prodTags').value=(p.tags||[]).join(','); if(p.imageDataURL){ previewImg.src=p.imageDataURL; previewImg.style.display='block'; } }
  }
  sellerModal.style.display='flex'; sellerModal.setAttribute('aria-hidden','false');
}
document.getElementById('closeSeller').onclick = ()=>{ sellerModal.style.display='none'; sellerModal.setAttribute('aria-hidden','true'); };

prodImage.onchange = async (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const data = await fileToDataURL(file);
  previewImg.src = data; previewImg.style.display='block';
};

/* form submit */
productForm.onsubmit = async (e)=>{
  e.preventDefault();
  const id = document.getElementById('prodId').value || uid('p');
  const title = document.getElementById('prodTitle').value.trim();
  const price = parseFloat(document.getElementById('prodPrice').value) || 0;
  const desc = document.getElementById('prodDesc').value.trim();
  const qty = parseInt(document.getElementById('prodQty').value) || 0;
  const tags = document.getElementById('prodTags').value.split(',').map(s=>s.trim()).filter(Boolean);
  let imageData = previewImg.src || '';
  // if a new file is selected, already loaded in preview
  const existingIndex = products.findIndex(p=>p.id===id);
  const payload = { id, title, price, desc, qty, tags, imageDataURL:imageData };
  if(existingIndex >= 0){ products[existingIndex] = payload; } else { products.unshift(payload); }
  saveProducts(); sellerModal.style.display='none'; sellerModal.setAttribute('aria-hidden','true'); renderProducts(searchInput.value);
};

document.getElementById('deleteProduct').onclick = ()=>{
  const id = document.getElementById('prodId').value;
  if(!id) return;
  if(!confirm('Delete this product?')) return;
  products = products.filter(p=>p.id !== id);
  saveProducts(); sellerModal.style.display='none'; renderProducts(searchInput.value);
};

/* Product placeholder data (if no image) */
function placeholderData(text){
  // create tiny SVG data URL with initials
  const initials = (text||'Item').split(' ').slice(0,2).map(s=>s[0]).join('').toUpperCase();
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='600' height='400'><rect width='100%' height='100%' fill='#eef2ff'/><text x='50%' y='50%' font-size='64' dominant-baseline='middle' text-anchor='middle' fill='#4338ca' font-family='Arial'>${initials}</text></svg>`;
  return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
}

/* small helpers */
function fileToDataURL(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }); }
function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* Product view close */
document.getElementById('closePm').onclick = closeProductModal;

/* Cart button */
document.getElementById('cartBtn').onclick = ()=>{ window.scrollTo({top:0,behavior:'smooth'}); };

/* Checkout flow */
document.getElementById('checkoutBtn').onclick = ()=>{ openCheckout(); };
document.getElementById('closeCheckout').onclick = ()=>{ checkoutModal.style.display='none'; checkoutModal.setAttribute('aria-hidden','true'); };

function openCheckout(){
  const keys = Object.keys(cart);
  if(keys.length===0) return alert('Your cart is empty.');
  const total = computeCartTotal();
  document.getElementById('checkoutTotal').textContent = money(total);
  checkoutModal.style.display='flex'; checkoutModal.setAttribute('aria-hidden','false');
}

document.getElementById('checkoutForm').onsubmit = (e)=>{
  e.preventDefault();
  const name = document.getElementById('custName').value.trim();
  const email = document.getElementById('custEmail').value.trim();
  const addr = document.getElementById('custAddr').value.trim();
  const items = Object.keys(cart).map(id=>{
    const p = products.find(x=>x.id===id);
    return { id, title: p?.title || 'Unknown', price: p?.price || 0, qty: cart[id] };
  });
  const total = computeCartTotal();
  const order = { id: uid('o'), timestamp: new Date().toISOString(), customer:{name,email,addr}, items, total };
  orders.push(order); saveOrders();
  // reduce stock
  items.forEach(it => {
    const p = products.find(x=>x.id===it.id);
    if(p){ p.qty = Math.max(0, p.qty - it.qty); }
  });
  saveProducts();
  // clear cart
  cart = {}; saveCart();
  renderCart(); renderProducts(searchInput.value);
  checkoutModal.style.display='none'; checkoutModal.setAttribute('aria-hidden','true');
  alert('Order placed — saved locally. Use "Download Orders" to export CSV for your records.');
};

/* Compute total */
function computeCartTotal(){ let total=0; Object.keys(cart).forEach(id=>{ const p=products.find(x=>x.id===id); if(p) total += p.price * cart[id]; }); return total; }

/* Persistence on load */
renderProducts();
renderCart();

/* Search */
searchInput.oninput = (e)=>renderProducts(e.target.value);

/* Mode UI - show/hide seller actions */
modeToggle.onchange = ()=>{
  const mode = modeToggle.value;
  if(mode === 'seller'){
    addProductBtn.style.display = 'inline-block';
    document.querySelectorAll('.ghost.viewBtn').forEach(x=>x.style.display='inline-block');
  } else {
    addProductBtn.style.display = 'none';
  }
};
modeToggle.dispatchEvent(new Event('change'));

/* seller modal close */
document.getElementById('closeSeller').onclick = ()=>{ sellerModal.style.display='none'; sellerModal.setAttribute('aria-hidden','true'); };

/* open product for editing when in seller mode by clicking view */
productGrid.addEventListener('click', (e)=>{
  const viewBtn = e.target.closest('.viewBtn');
  if(!viewBtn) return;
  const id = viewBtn.dataset.id;
  if(modeToggle.value === 'seller'){ openSellerModal(id); }
});

/* clear cart */
document.getElementById('clearCart').onclick = ()=>{ if(confirm('Clear cart?')){ cart={}; saveCart(); renderCart(); } };

/* download orders as CSV */
downloadOrdersBtn.onclick = ()=>{
  if(orders.length === 0) return alert('No orders yet.');
  const rows = [['order_id','timestamp','customer_name','customer_email','customer_address','item_id','item_title','item_price','item_qty','order_total']];
  orders.forEach(o=>{
    o.items.forEach(it=>{
      rows.push([o.id,o.timestamp,o.customer.name,o.customer.email,o.customer.addr,it.id,it.title,it.price,it.qty,o.total]);
    });
  });
  const csv = rows.map(r=>r.map(cell=>`"${String(cell).replaceAll('"','""')}"`).join(',')).join('\\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = 'orders.csv'; a.click(); URL.revokeObjectURL(url);
};

/* helper to export orders programmatically (button alternative) */
function exportOrdersCSV(){
  downloadOrdersBtn.click();
}

/* small demo: allow double-click product image to edit (seller mode) */
productGrid.addEventListener('dblclick', (e)=>{
  const card = e.target.closest('.card');
  if(!card) return;
  const btn = card.querySelector('.viewBtn');
  if(btn && modeToggle.value === 'seller'){ openSellerModal(btn.dataset.id); }
});

/* initial UI tweaks */
document.getElementById('addProductBtn').style.display = modeToggle.value === 'seller' ? 'inline-block' : 'none';

/* Save products & cart on unload */
window.addEventListener('beforeunload', ()=>{ saveProducts(); saveCart(); saveOrders(); });

</script>
</body>
</html>
